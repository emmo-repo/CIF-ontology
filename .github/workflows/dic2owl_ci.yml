name: CI - dic2owl

on:
  push:
    paths:
      - 'dic2owl/**'
      - 'tests/**'
      - '.github/**'

jobs:
  dic2owl-basic:
    name: External
    uses: SINTEF/ci-cd/.github/workflows/ci_tests.yml@v1
    with:
      # general setup
      python_version: "3.7"
      install_extras: "./dic2owl[dev]"
      run_build_package: false
      run_build_docs: false

      # pre-commit
      run_pre-commit: true
      skip_pre-commit_hooks: pylint

      # pylint
      run_pylint: true
      pylint_targets: "dic2owl/**/*.py"
      pylint_options: "--rcfile=dic2owl/pyproject.toml"

      # safety
      run_safety: true
      # Ignore ID 44715 for now.
      # See this NumPy issue for more information: https://github.com/numpy/numpy/issues/19038
      # Remove ignoring 48547 as soon as RDFLib/rdflib#1844 has been fixed and the fix
      # has been released.
      safety_options: |
        --ignore=44715
        --ignore=44716
        --ignore=44717
        --ignore=48547

  dic2owl-test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.7", "3.8", "3.9"]

    steps:
      - uses: actions/checkout@v3

      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v4
        with:
          python-version:  ${{ matrix.python-version }}

      - name: Install dependencies
        run: |
          python -m pip install -U pip
          pip install -U setuptools wheel
          pip install -e ./dic2owl[dev]

      - name: Run unit tests with PyTest
        run: pytest -c dic2owl/pyproject.toml
